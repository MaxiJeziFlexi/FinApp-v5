> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

üîó Initializing database connection...
‚úÖ Database connection pool initialized successfully
Creating advisor service with 3 advisors
1:02:50 PM [express] üöÄ Starting server initialization...
1:02:51 PM [express] ‚úì Environment variables validated
1:02:51 PM [express] Testing database connection...
1:02:51 PM [express] ‚úì Database connection validated
1:02:51 PM [express] Registering routes...
üß™ Test routes registered for RBAC security testing
1:02:51 PM [express] ‚úì Routes registered successfully
1:02:51 PM [express] Setting up Vite development server...
1:02:51 PM [express] ‚úì Vite development server setup complete
1:02:51 PM [express] Starting server on port 4000...
1:02:51 PM [express] ‚úì Server running successfully on port 4000
1:02:51 PM [express] üåê Server accessible at http://0.0.0.0:4000
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
1:02:58 PM [express] GET /api/auth/user 401 in 1ms :: {"message":"Unauthorized"}
Error creating default profile: error: insert or update on table "user_profiles" violates foreign key constraint "user_profiles_user_id_users_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createUserProfile (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:256:26)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:502:23) {
  length: 297,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (user_id)=(admin-user) is not present in table "users".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_profiles',
  column: undefined,
  dataType: undefined,
  constraint: 'user_profiles_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
Analytics Event - User: demo-user, Type: page_view, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.315Z"}
Analytics Event - User: demo-user, Type: page_leave, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.316Z"}
Analytics Event - User: admin-user, Type: page_view, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 0ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.317Z"}
1:02:58 PM [express] GET /api/auth/user 401 in 1ms :: {"message":"Unauthorized"}
Analytics Event - User: demo-user, Type: page_view, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.538Z"}
Analytics Event - User: demo-user, Type: page_leave, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.541Z"}
Analytics Event - User: admin-user, Type: page_view, Data: undefined
1:02:58 PM [express] POST /api/analytics/track-event 200 in 0ms :: {"success":true,"timestamp":"2025-08-21T11:02:58.541Z"}
Error creating default profile: error: insert or update on table "user_profiles" violates foreign key constraint "user_profiles_user_id_users_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createUserProfile (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:256:26)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:502:23) {
  length: 297,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (user_id)=(admin-user) is not present in table "users".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_profiles',
  column: undefined,
  dataType: undefined,
  constraint: 'user_profiles_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:02:58 PM [express] GET /api/user/profile 200 in 381ms :: {"userId":"admin-user","financialGoal":"emergency_fund","timeframe":"medium","monthlyIncome":"high","currentSavings":"medium","targetAmount":"50000","onboardingComplete":true,"isPremium":true,"progress":75,"consents":{"termsAccepted":true,"privacyAccepted":true‚Ä¶
Analytics Event - User: admin-user, Type: page_leave, Data: undefined
1:03:00 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:03:00.605Z"}
Analytics Event - User: admin-user, Type: page_view, Data: undefined
1:03:00 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:03:00.606Z"}
1:03:00 PM [express] GET /api/advisors 304 in 1ms :: [{"id":"financial_planner","name":"ARIA - AI Financial Strategist","description":"Supercharged AI advisor with full app access, real-time analytics, and predictive modeling capabilities.","expertise":["advanced_portfolio_optimization","predictive_modeling","real_time‚Ä¶
Analytics Event - User: admin-user, Type: page_leave, Data: undefined
1:03:02 PM [express] POST /api/analytics/track-event 200 in 2ms :: {"success":true,"timestamp":"2025-08-21T11:03:02.159Z"}
Analytics Event - User: admin-user, Type: page_view, Data: undefined
1:03:02 PM [express] POST /api/analytics/track-event 200 in 1ms :: {"success":true,"timestamp":"2025-08-21T11:03:02.166Z"}
1:03:02 PM [express] GET /api/personalized-tree/investment_specialist 304 in 20ms :: {"advisorId":"investment_specialist","name":"Investment Psychology Profile","description":"Discover your investment personality and build a strategy that matches your emotional comfort zone","categories":["risk_psychology","time_perspe‚Ä¶
Public button click tracking error: error: insert or update on table "user_interaction_events" violates foreign key constraint "user_interaction_events_session_id_user_sessions_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createInteractionEvent (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:996:23)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:67:7) {
  length: 381,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (session_id)=(session_1755774185512) is not present in table "user_sessions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_interaction_events',
  column: undefined,
  dataType: undefined,
  constraint: 'user_interaction_events_session_id_user_sessions_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:05 PM [express] POST /api/public/analytics/button-click 500 in 379ms :: {"message":"Failed to track button click","error":"insert or update on table \"user_interaction_events\" violates foreign key constraint \"user_interaction_events_session_id_user_sessions_id_fk\""}
Public button click tracking error: error: insert or update on table "user_interaction_events" violates foreign key constraint "user_interaction_events_session_id_user_sessions_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createInteractionEvent (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:996:23)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:67:7) {
  length: 381,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (session_id)=(session_1755774186513) is not present in table "user_sessions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_interaction_events',
  column: undefined,
  dataType: undefined,
  constraint: 'user_interaction_events_session_id_user_sessions_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:06 PM [express] POST /api/public/analytics/button-click 500 in 364ms :: {"message":"Failed to track button click","error":"insert or update on table \"user_interaction_events\" violates foreign key constraint \"user_interaction_events_session_id_user_sessions_id_fk\""}
Saving progress with cleaned values: {
  id: 'progress_27b80d53-eb47-4b3c-9dcd-beddd80520f2',
  userId: 'admin-user',
  advisorId: 'investment_specialist',
  treeType: 'personalized',
  currentNode: 'market_reaction',
  progress: 20,
  responses: 'json array',
  recommendations: 'json object'
}
Error processing personalized response: error: insert or update on table "decision_tree_progress" violates foreign key constraint "decision_tree_progress_user_id_users_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.saveDecisionTreeProgress (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:457:29)
    at async PersonalizedDecisionTreeService.processPersonalizedResponse (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/services/personalizedDecisionTreeService.ts:1278:5)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:1043:22) {
  length: 333,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (user_id)=(admin-user) is not present in table "users".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'decision_tree_progress',
  column: undefined,
  dataType: undefined,
  constraint: 'decision_tree_progress_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:07 PM [express] POST /api/personalized-tree/respond 500 in 830ms :: {"message":"Failed to process response"}
Public button click tracking error: error: insert or update on table "user_interaction_events" violates foreign key constraint "user_interaction_events_session_id_user_sessions_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createInteractionEvent (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:996:23)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:67:7) {
  length: 381,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (session_id)=(session_1755774189434) is not present in table "user_sessions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_interaction_events',
  column: undefined,
  dataType: undefined,
  constraint: 'user_interaction_events_session_id_user_sessions_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:10 PM [express] POST /api/public/analytics/button-click 500 in 580ms :: {"message":"Failed to track button click","error":"insert or update on table \"user_interaction_events\" violates foreign key constraint \"user_interaction_events_session_id_user_sessions_id_fk\""}
Public button click tracking error: error: insert or update on table "user_interaction_events" violates foreign key constraint "user_interaction_events_session_id_user_sessions_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createInteractionEvent (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:996:23)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:67:7) {
  length: 381,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (session_id)=(session_1755774190434) is not present in table "user_sessions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'user_interaction_events',
  column: undefined,
  dataType: undefined,
  constraint: 'user_interaction_events_session_id_user_sessions_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:10 PM [express] POST /api/public/analytics/button-click 500 in 262ms :: {"message":"Failed to track button click","error":"insert or update on table \"user_interaction_events\" violates foreign key constraint \"user_interaction_events_session_id_user_sessions_id_fk\""}
Saving progress with cleaned values: {
  id: 'progress_7b7bfba0-d0fd-4e93-9699-5198e8d9617b',
  userId: 'admin-user',
  advisorId: 'investment_specialist',
  treeType: 'personalized',
  currentNode: 'market_reaction',
  progress: 20,
  responses: 'json array',
  recommendations: 'json object'
}
Error processing personalized response: error: insert or update on table "decision_tree_progress" violates foreign key constraint "decision_tree_progress_user_id_users_id_fk"
    at file:///Users/maksbraziewicz/Downloads/FinAdvisor%204/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (/Users/maksbraziewicz/Downloads/FinAdvisor 4/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.saveDecisionTreeProgress (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/storage.ts:457:29)
    at async PersonalizedDecisionTreeService.processPersonalizedResponse (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/services/personalizedDecisionTreeService.ts:1278:5)
    at async <anonymous> (/Users/maksbraziewicz/Downloads/FinAdvisor 4/server/routes.ts:1043:22) {
  length: 333,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (user_id)=(admin-user) is not present in table "users".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'decision_tree_progress',
  column: undefined,
  dataType: undefined,
  constraint: 'decision_tree_progress_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}
1:03:10 PM [express] POST /api/personalized-tree/respond 500 in 394ms :: {"message":"Failed to process response"}
