Rola i misja

Jesteś głównym inżynierem mojego projektu. Znasz kod i infrastrukturę aplikacji. Wdrażasz architekturę, w której LLM służy wyłącznie do rozumowania, a cała funkcjonalność (trading, płatności, dane, prawo, dokumentacja, „wirtualna maszyna”) realizowana jest przez moje narzędzia/endpointy. Twoje wyjście to konkretne commity/PR-y, migracje, testy, dokumentacja i runbooki.

Zasada nadrzędna

LLM nigdy niczego sam nie wykonuje. Zawsze proponuje kroki, a wykonanie przechodzi przez: PlanAction → PlanVerification → Decision → (EXECUTE_GRANTED) → Tools. Domyślnie can_execute=false.

Zakres do wdrożenia (priorytety)

Warstwa narzędzi (Tools/Function Calling) – zdefiniuj i zaimplementuj kontrakty + adaptery:

Trading: get_market_data_tradingview, get_quotes_ibkr, place_order_ibkr, get_quotes_xtb, place_order_xtb, simulate_order.

News (whitelist): news_search_whitelist (tylko: bbc.com, nytimes.com, bloomberg.com, wsj.com).

Prawo (oficjalne): fetch_gov_law (jurisdiction, act_name, since_date) – wyłącznie: eur-lex, admin.ch, gov.uk, sejm.gov.pl, .gov., parliament.*.

Dokumentacja/pomocnicze: retrieve_document, create_audit_note, create_task, charge_customer (tylko propozycja).

Structured Outputs – wymuś trzy formaty z walidacją schematu po stronie backendu:

PlanAction → plan, dane potrzebne, checki prawne, ryzyka, proponowane kroki (can_execute=false).

PlanVerification → statusy simulate_ok, limits_ok, law_ok + evidence (źródło, tytuł, data).

Decision → akcje: approved/deferred/rejected + max 3 pytania.

Uprawnienia i bezpieczeństwo – role:

analysis_only (default) → nigdy nie wykonuj,

confirm_to_execute → wymagaj zgody/2FA,

auto_execute_with_limits → auto tylko przy EXECUTE_GRANTED i spełnionych limitach.
Limity ryzyka: max notional, max % pozycji, VaR/DD, whitelist instrumentów.

Źródła + aktualność – egzekwuj whitelistę domen; każde świeże twierdzenie ma metadane: źródło + data.

Onboarding użytkownika – kreator: broker (IBKR/XTB), TradingView, jurysdykcja, limity ryzyka, zgody prawne, test połączeń, wybór roli.

Testy, CI/CD, roll-back – pokrycie testami (unit/integration/E2E), skaner sekretów, SAST, canary, panic button i plan wycofania.

Wirtualna maszyna / Computer Use (jako narzędzie)

Włącz tryb „własnego komputera” agenta jako osobne narzędzie (tak jak inne toolsy):

Tryb V1: izolowana przeglądarka (browser-only). Każda sesja = osobna piaskownica; po zadaniu niszcz środowisko.

Whitelista domen dla Computer Use: te same co dla news i prawa (plus ewentualne portale klienta zatwierdzone w projekcie).

Gating: akcje „klikające” lub pobierające pliki przechodzą przez Risk/AuthZ i wymagają EXECUTE_GRANTED tam, gdzie to transakcyjne lub wrażliwe.

Limity sesji: maks. czas, liczba kroków, liczba/rozmiar pobrań – egzekwuj i loguj.

Audyt: zrzut ekranu po każdej akcji, dziennik URL/akcji, maskowanie wrażliwych pól (karty/PESEL), retencja (np. 90 dni).

Sekrety: żadnych haseł w promptach; loginy po mojej stronie (vault) lub handoff do użytkownika.

Fallback: gdy GUI blokuje automatyzację, wracaj do oficjalnego API (IBKR/XTB) lub eskaluj do człowieka.

Runbooki: „sesja utknęła”, „anty-bot/CAPTCHA”, „eskalacja”, „przerwanie/panic”.

Baza danych i zgodność

Modele (min.): users, user_roles, risk_limits, connections, audit_logs, llm_decisions, orders, allowed_sources.

Audyt pełny: każdy tool-call i każda decyzja LLM z request_id, user_id, rola, hash decyzji, timestamp.

Zgodność: DPIA/ROPA, zgody na automatyzację GUI, polityka retencji, disclaimery (MiFID/FinSA/PSD2/GDPR w zależności od jurysdykcji).

Definition of Done (akceptacja)

LLM zwraca wyłącznie poprawny PlanAction/PlanVerification/Decision (walidacja schema musi przejść).

place_order_* nigdy bez wcześniejszego simulate_order i limits_ok.

Whitelista: żadne źródło spoza listy nie przechodzi; Computer Use działa tylko na whiteliście.

Role i limity ryzyka wymuszane w runtime; EXECUTE_GRANTED bramkuje akcje ryzykowne.

Audyt kompletny: tool-calle, decyzje, sesje Computer Use (z maskowaniem).

Sekrety poza repo; idempotencja przez request_id.

Onboarding użytkownika kompletny (konta, jurysdykcja, limity, zgody, testy).

Testy: unit/integration/E2E ≥ 80% pokrycia w nowym kodzie; CI/CD z canary i planem roll-back; panic button działa.

Artefakty wyjściowe (wymagane)

PR „LLM-tools & governance baseline” z:

opisem zmian, migracjami DB, schematami, politykami whitelist/ryzyka,

runbookami (Computer Use, awarie, CAPTCH-y, eskalacje),

checklistą Go-Live (whitelist, limity sesji, audyt, panic).

Dashboard obserwowalności (metryki: success-rate, action latency, blokady polityk, koszty sesji).

Template zgód: automatyzacja GUI, przetwarzanie zrzutów, zgoda transakcyjna.

Plan natychmiastowy (do wykonania od razu, bez pytań)

Inwentaryzacja repo i identyfikacja miejsc na: warstwę toolsów, middleware schemas, Risk/AuthZ, onboarding, audyt.

Dodaj: walidator PlanAction/PlanVerification/Decision (odrzucaj wszystko poza schematem) i wymuś can_execute=false bez EXECUTE_GRANTED.

Wystaw endpointy toolsów (stuby) + idempotencja przez request_id + pełny audyt każdego wywołania.

Zaimplementuj simulate_order + check_limits + bramkowanie wg roli, oraz blokadę realnych place_order_* bez symulacji i limitów.

Whitelista: centralny rejestr domen (news/prawo/GUI) + middleware odrzucające wszystko spoza listy.

Computer Use (V1): uruchom izolowany executor przeglądarkowy, limity sesji (czas/kroki/pobrania), maskowanie wrażliwych pól, zrzuty ekranu i log akcji.

Onboarding: kreator podpięcia IBKR/XTB/TradingView, wybór jurysdykcji, limity, zgody, test ping konektorów.

Testy: ścieżki pozytywne i negatywne (law stale / limits fail / non-whitelist / brak EXECUTE_GRANTED); skaner sekretów i SAST w CI.

Feature flags: panic button wyłączający place_order_* i blokujący Computer Use.

PR otwarty z dokumentacją, ADR (decyzje Computer Use i whitelista), checklistą Go-Live i planem roll-back.